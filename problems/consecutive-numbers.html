<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>#SQL-3 Consecutive Numbers - HackerRank</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,sans-serif;background:#F5F8FA;line-height:1.6}.container{max-width:1000px;margin:0 auto;padding:24px}.header{background:#FFF;padding:16px 0;margin-bottom:24px;border-bottom:1px solid #ddd}.back-link{color:#00EA64;text-decoration:none;font-weight:600}.content{background:#FFF;padding:32px;border-radius:8px}.difficulty{display:inline-block;padding:4px 12px;background:rgba(255,193,7,0.12);color:#F57C00;border-radius:4px;font-size:12px;font-weight:600}h1{font-size:28px;margin:12px 0}h2{font-size:20px;margin:24px 0 12px}h3{font-size:16px;margin:16px 0 8px}.tag{display:inline-block;padding:4px 12px;background:#EDF1F5;border-radius:4px;font-size:12px;margin-right:8px}.content-box{background:#F5F8FA;border-left:3px solid #00EA64;padding:16px;border-radius:4px;margin:12px 0}pre{background:#282c34;color:#abb2bf;padding:16px;border-radius:6px;overflow-x:auto;margin:12px 0}table{width:100%;border-collapse:collapse;margin:12px 0;background:#FFF;border:1px solid #ddd}th{background:#f5f5f5;padding:12px;text-align:left;font-weight:600;border-bottom:2px solid #ddd}td{padding:12px;border-bottom:1px solid #ddd}ul{margin-left:24px}li{margin:8px 0}</style>
</head>
<body>
    <div class="header"><div class="container"><a href="../index.html" class="back-link">← 返回題目列表</a></div></div>
    <div class="container"><div class="content">
        <span class="difficulty">MEDIUM</span>
        <h1>#SQL-3 Consecutive Numbers</h1>
        <div><span class="tag">SQL</span><span class="tag">Database</span></div>
        
        <h2>題目描述</h2>
        <div class="content-box">
            <p>找出連續出現至少三次的數字，考驗自連接（Self Join）的使用。</p>
        </div>
        
        <h2>資料表結構</h2>
        <div class="content-box">
            <h3>Logs 表格：</h3>
            <table>
                <tr><th>欄位</th><th>型態</th><th>說明</th></tr>
                <tr><td>id</td><td>INT</td><td>主鍵（自動遞增）</td></tr>
                <tr><td>num</td><td>INT</td><td>數字</td></tr>
            </table>
        </div>
        
        <h2>範例資料</h2>
        <div class="content-box">
            <table>
                <tr><th>id</th><th>num</th></tr>
                <tr><td>1</td><td>1</td></tr>
                <tr><td>2</td><td>1</td></tr>
                <tr><td>3</td><td>1</td></tr>
                <tr><td>4</td><td>2</td></tr>
                <tr><td>5</td><td>1</td></tr>
                <tr><td>6</td><td>2</td></tr>
                <tr><td>7</td><td>2</td></tr>
            </table>
        </div>
        
        <h2>SQL 解法</h2>
        
        <h3>方法一：Self Join（自連接）</h3>
        <pre><code class="language-sql">SELECT DISTINCT l1.num AS ConsecutiveNums
FROM Logs l1
JOIN Logs l2 ON l1.id = l2.id - 1 AND l1.num = l2.num
JOIN Logs l3 ON l2.id = l3.id - 1 AND l2.num = l3.num;</code></pre>
        
        <h3>方法二：使用窗口函數 LAG/LEAD</h3>
        <pre><code class="language-sql">WITH ConsecutiveCheck AS (
    SELECT 
        num,
        LAG(num, 1) OVER (ORDER BY id) AS prev_num,
        LAG(num, 2) OVER (ORDER BY id) AS prev_prev_num
    FROM Logs
)
SELECT DISTINCT num AS ConsecutiveNums
FROM ConsecutiveCheck
WHERE num = prev_num AND num = prev_prev_num;</code></pre>
        
        <h3>方法三：使用變數（MySQL）</h3>
        <pre><code class="language-sql">SELECT DISTINCT num AS ConsecutiveNums
FROM (
    SELECT 
        num,
        @count := IF(@prev = num, @count + 1, 1) AS consecutive_count,
        @prev := num
    FROM Logs,
    (SELECT @count := 0, @prev := NULL) AS vars
    ORDER BY id
) AS counted
WHERE consecutive_count >= 3;</code></pre>
        
        <h2>預期輸出</h2>
        <div class="content-box">
            <table>
                <tr><th>ConsecutiveNums</th></tr>
                <tr><td>1</td></tr>
            </table>
            <p>解釋：數字 1 在 id = 1, 2, 3 處連續出現了 3 次。</p>
        </div>
        
        <h2>解題關鍵</h2>
        <div class="content-box">
            <h3>Self Join 思路：</h3>
            <ul>
                <li>將表格與自己 JOIN 三次</li>
                <li>條件：id 連續且 num 相同</li>
                <li>l1.id = l2.id - 1 確保 id 連續</li>
                <li>l1.num = l2.num 確保值相同</li>
            </ul>
            
            <h3>窗口函數思路：</h3>
            <ul>
                <li>LAG() 獲取前一行的值</li>
                <li>比較當前行和前兩行的值</li>
                <li>如果三個值都相同，則符合條件</li>
            </ul>
        </div>
        
        <h2>視覺化過程</h2>
        <div class="content-box">
            <pre>原始資料：
id  num
1   1    ← 
2   1    ← 這三行連續且值相同
3   1    ← 
4   2
5   1
6   2
7   2

Self Join 過程：
l1(id=1, num=1) + l2(id=2, num=1) + l3(id=3, num=1) ✓
l2(id=2, num=1) + l3(id=3, num=1) + l4(id=4, num=2) ✗
...</pre>
        </div>
        
        <h2>面試要點</h2>
        <div class="content-box">
            <h3>常見追問：</h3>
            <ul>
                <li>如何找連續出現 N 次的數字？</li>
                <li>如何處理 id 不連續的情況？</li>
                <li>Self Join 和窗口函數哪個效率更高？</li>
                <li>如何找最長的連續序列？</li>
            </ul>
            
            <h3>優化建議：</h3>
            <ul>
                <li>在 id 欄位上建立索引</li>
                <li>窗口函數通常比 Self Join 更高效</li>
                <li>使用 DISTINCT 避免重複結果</li>
                <li>考慮資料量選擇合適方法</li>
            </ul>
        </div>
    </div></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>